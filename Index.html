<main>
    <section id="hero-section">
        <h1>Effortless Invoicing, Powered by AI.</h1>
        <p>Create professional invoices in seconds, manage clients, and track payments with intelligent automation. Simplify your business finances.</p>
        <div class="hero-buttons">
            <button id="get-started-btn" class="cta-button">Get Started Free</button>
            <button id="learn-more-btn" class="cta-button secondary-cta">Learn More</button>
        </div>
    </section>

    <section id="pricing-section" class="section-container">
        <h2>Flexible Plans for Every Business</h2>
        <p class="section-description">Choose the plan that fits your invoicing needs. Upgrade anytime.</p>

        <div class="pricing-toggle">
            <button id="monthly-toggle" class="toggle-button active">Monthly</button>
            <button id="yearly-toggle" class="toggle-button">Annually <span class="badge">Save 20%</span></button>
        </div>

        <div class="pricing-cards-container">
            <div class="pricing-card">
                <h3>Free</h3>
                <p class="price-value"><span class="currency-symbol">$</span>0<span class="price-period">/month</span></p>
                <p class="price-description">Perfect for light users getting started.</p>
                <ul class="features-list">
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> 5 Invoices/month</li>
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Basic PDF Export</li>
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Limited Client Management</li>
                    <li class="faded-feature"><svg class="x-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> AI Suggestions</li>
                    <li class="faded-feature"><svg class="x-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> Priority Support</li>
                </ul>
                <button class="cta-button plan-button" data-plan="free" data-price="0">Start Free</button>
            </div>

            <div class="pricing-card primary-plan">
                <span class="badge recommended-badge">Recommended</span>
                <h3>Pro</h3>
                <p class="price-value"><span class="currency-symbol">$</span><span class="price-monthly">9</span><span class="price-yearly" style="display:none;">72</span><span class="price-period">/month</span></p>
                <p class="price-description">Grow your business with advanced features.</p>
                <ul class="features-list">
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> 50 Invoices/month</li>
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Advanced PDF Customization</li>
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Unlimited Client Management</li>
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> AI Suggestions</li>
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Email Support</li>
                </ul>
                <button class="cta-button plan-button" data-plan="pro" data-price-monthly="9" data-price-yearly="72">Choose Pro</button>
            </div>

            <div class="pricing-card">
                <h3>Advanced</h3>
                <p class="price-value"><span class="currency-symbol">$</span><span class="price-monthly">19</span><span class="price-yearly" style="display:none;">180</span><span class="price-period">/month</span></p>
                <p class="price-description">For large businesses and agencies.</p>
                <ul class="features-list">
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Unlimited Invoices</li>
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Custom Branding & Templates</li>
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Unlimited Client Management</li>
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> AI Suggestions</li>
                    <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Priority Support & Dedicated Account Manager</li>
                </ul>
                <button class="cta-button plan-button" data-plan="advanced" data-price-monthly="19" data-price-yearly="180">Choose Advanced</button>
            </div>
        </div>
    </section>

    <section id="auth-section">
        <div class="auth-wrapper">
            <div class="auth-branding">
                <h2>Simplify Your Invoicing</h2>
                <p>Go from draft to paid, faster. Create professional, compliant invoices in seconds with the power of AI.</p>
                <ul class="features">
                    <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> AI-Powered Suggestions</li>
                    <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Secure & Reliable</li>
                    <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Global Currencies & Taxes</li>
                </ul>
            </div>
            <div class="auth-container">
                <h3>Sign In or Sign Up</h3>
                <button id="google-signin-btn" class="auth-button google">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="Google" class="google-icon"/>
                    Continue with Google
                </button>
                <div class="divider">OR</div>
                <input type="email" id="email-input" placeholder="Enter your email" required>
                <button id="sign-in-email-btn" class="auth-button primary">Continue with Email</button>
                <p id="auth-message" class="message"></p>
            </div>
        </div>
    </section>

    <section id="dashboard-section" style="display: none;">
        <div class="dashboard-grid">
            <div class="card" id="profile-card">
                <h3>Your Profile</h3>
                <p><strong>Email:</strong> <span id="profile-email"></span></p>
                <p><strong>Current Plan:</strong> <span id="profile-plan"></span></p>
                <p><strong>Invoices This Month:</strong> <span id="profile-invoice-count"></span></p>
                <button id="manage-profile-btn" class="cta-button outline-button" style="width: auto;">Manage Account</button>
            </div>

            <div class="card" id="invoice-generator-card">
                <h3>Create New Invoice</h3>
                <form id="invoice-form">
                    <input type="text" id="client-name" name="client_name" placeholder="Client Name" required>
                    <input type="email" id="client-email" name="client_email" placeholder="Client Email" required>
                    <textarea id="item-description" name="item_description" placeholder="Item Description (e.g., Web Design Services)" required></textarea>
                    <div class="form-row" style="display: flex; gap: 1rem;">
                        <input type="number" id="quantity" name="quantity" placeholder="Quantity" required min="1">
                        <input type="number" id="unit-price" name="unit_price" placeholder="Unit Price" required min="0" step="0.01">
                    </div>
                    <div class="form-row" style="display: flex; gap: 1rem;">
                        <input type="text" id="currency" name="currency" value="USD">
                        <input type="number" id="tax-rate" name="tax_rate" placeholder="Tax Rate (%)" min="0">
                    </div>
                    <label for="due-date">Due Date:</label>
                    <input type="date" id="due-date" name="due_date" required>
                    <button type="submit" id="generate-invoice-btn" class="cta-button">Generate & Download PDF</button>
                </form>
                <p id="invoice-message" class="message"></p>
            </div>

            <div class="card" id="upgrade-section">
                <h3>Upgrade Your Plan</h3>
                <p>Unlock more features and higher invoice limits!</p>
                <div class="upgrade-plans-grid">
                    <div class="upgrade-plan-card">
                        <h4>Pro Plan</h4>
                        <p class="upgrade-price">$<span class="upgrade-monthly-pro">9</span>/month</p>
                        <ul class="upgrade-features">
                            <li>Up to 50 invoices/month</li>
                            <li>Advanced PDF customization</li>
                            <li>AI Suggestions</li>
                        </ul>
                        <button class="cta-button select-upgrade-plan-btn" data-plan="pro" data-price-monthly="9" data-price-yearly="72">Upgrade to Pro</button>
                    </div>
                    <div class="upgrade-plan-card">
                        <h4>Advanced Plan</h4>
                        <p class="upgrade-price">$<span class="upgrade-monthly-advanced">19</span>/month</p>
                        <ul class="upgrade-features">
                            <li>Unlimited Invoices</li>
                            <li>Custom Branding</li>
                            <li>Priority Support</li>
                        </ul>
                        <button class="cta-button select-upgrade-plan-btn" data-plan="advanced" data-price-monthly="19" data-price-yearly="180">Upgrade to Advanced</button>
                    </div>
                </div>
                <p id="upgrade-message" class="message"></p>
            </div>
        </div>
    </section>
</main>
<style>
    :root {
        --primary-color: #0d6efd;
        --secondary-color: #6c757d;
        --bg-light: #f4f7f6; /* Slightly softer background */
        --text-light: #212529;
        --bg-dark: #1e2733; /* Deeper dark background */
        --text-dark: #e0e6eb; /* Lighter text for dark mode */
        --card-bg-light: #ffffff;
        --card-bg-dark: #2a3848; /* Darker card background */
        --border-color-light: #e0e4e8; /* Softer border */
        --border-color-dark: #4a5d71; /* Clearer dark border */
        --success-color: #28a745; /* Standard green */
        --error-color: #dc3545; /* Standard red */
        --font-heading: 'Poppins', sans-serif;
        --font-body: 'Inter', sans-serif;
        --highlight-yellow: #ffc107; /* For "Save X%" badge */
    }

    body {
        font-family: var(--font-body);
        margin: 0;
        transition: background-color 0.3s, color 0.3s;
        overflow-x: hidden;
        line-height: 1.6;
    }

    /* Mode Specific Styles */
    .light-mode { background-color: var(--bg-light); color: var(--text-light); }
    .dark-mode { background-color: var(--bg-dark); color: var(--text-dark); }
    .dark-mode .card, .dark-mode header, .dark-mode .auth-wrapper,
    .dark-mode .pricing-card, .dark-mode .toggle-button {
        background-color: var(--card-bg-dark);
        border-color: var(--border-color-dark);
        box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* Stronger shadow for dark mode */
    }
    .dark-mode input, .dark-mode textarea {
        background-color: #3b4e61; /* Darker input background */
        color: var(--text-dark);
        border-color: var(--border-color-dark);
    }
    .dark-mode input::placeholder, .dark-mode textarea::placeholder { color: #aebecf; }
    .dark-mode .divider::before, .dark-mode .divider::after { background-color: var(--border-color-dark); }
    .dark-mode .auth-button.google {
        background-color: #3b4e61;
        color: var(--text-dark);
        border-color: var(--border-color-dark);
    }
    .dark-mode .auth-button.google:hover { background-color: #4a5d71; }
    .dark-mode .faded-feature { color: #8a9ba5; } /* Faded for dark mode */


    header {
        background: var(--card-bg-light);
        box-shadow: 0 4px 12px rgba(0,0,0,0.08); /* Stronger shadow */
        padding: 1rem 2rem; /* More padding */
        border-bottom: 1px solid var(--border-color-light);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000; /* Higher z-index */
    }
    nav { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
    .logo-title {
        font-size: 1.8rem; /* Larger logo */
        color: var(--primary-color);
        font-weight: 700; /* Bolder */
        font-family: var(--font-heading);
    }
    
    main {
        padding: 1rem;
        max-width: 1200px; /* Slightly wider main content */
        margin: 8rem auto 2rem auto;
    }

    /* --- General Section Styling --- */
    .section-container {
        padding: 4rem 2rem;
        text-align: center;
        margin-bottom: 4rem;
    }
    .section-container h2 {
        font-family: var(--font-heading);
        font-size: 2.8rem;
        margin-bottom: 1rem;
        color: var(--text-light); /* Ensure visibility in light mode */
    }
    .dark-mode .section-container h2 { color: var(--text-dark); }
    .section-description {
        font-size: 1.2rem;
        max-width: 700px;
        margin: 0 auto 3rem auto;
        color: var(--secondary-color);
    }


    /* --- Hero Section --- */
    #hero-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        min-height: calc(100vh - 100px); /* Adjust height */
        margin-top: -60px; /* Pull up to fill space below header */
        padding: 2rem;
        background: linear-gradient(135deg, var(--primary-color) 0%, #007bff 100%); /* Blue gradient */
        color: white;
        border-radius: 15px; /* Slightly rounded corners */
        margin-bottom: 4rem;
        box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        position: relative;
        overflow: hidden;
    }

    #hero-section h1 {
        font-family: var(--font-heading);
        font-size: 3.5rem; /* Large, impactful heading */
        margin-bottom: 1.5rem;
        font-weight: 700;
        line-height: 1.2;
        text-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }
    #hero-section p {
        font-size: 1.4rem; /* Clear, concise sub-text */
        max-width: 800px;
        margin-bottom: 2.5rem;
        font-weight: 400;
    }
    .hero-buttons .cta-button {
        padding: 18px 35px; /* Larger buttons */
        font-size: 1.2rem;
        border-radius: 50px; /* Pill shape */
        margin: 0 1rem;
        background-color: white;
        color: var(--primary-color);
        box-shadow: 0 8px 15px rgba(0,0,0,0.15);
    }
    .hero-buttons .cta-button:hover {
        background-color: #f0f0f0;
        transform: translateY(-3px);
        box-shadow: 0 12px 20px rgba(0,0,0,0.25);
    }
    .hero-buttons .secondary-cta {
        background-color: transparent;
        border: 2px solid white;
        color: white;
        box-shadow: none;
    }
    .hero-buttons .secondary-cta:hover {
        background-color: rgba(255,255,255,0.1);
        transform: translateY(-3px);
        box-shadow: none;
    }


    /* --- Auth Section --- */
    #auth-section {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: calc(100vh - 100px); /* Adjust height for hero section presence */
        margin-top: 4rem; /* Space after hero */
        margin-bottom: 4rem;
    }
    .auth-wrapper {
        display: flex;
        width: 100%;
        max-width: 950px; /* Slightly wider */
        background: var(--card-bg-light);
        border-radius: 16px; /* More rounded */
        box-shadow: 0 15px 40px rgba(0,0,0,0.15); /* Deeper shadow */
        overflow: hidden;
        border: 1px solid var(--border-color-light);
    }
    .auth-branding {
        background: linear-gradient(160deg, var(--primary-color), #007bff); /* Smoother gradient */
        color: white;
        padding: 50px; /* More padding */
        width: 45%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }
    .auth-branding::before { /* Subtle background pattern */
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: radial-gradient(circle at 100% 150%, var(--primary-color) 0%, rgba(255,255,255,0) 80%), radial-gradient(circle at 0% -50%, var(--primary-color) 0%, rgba(255,255,255,0) 80%);
        opacity: 0.2;
        pointer-events: none;
    }
    .auth-branding h2 {
        font-size: 2.5rem; /* Larger heading */
        margin-bottom: 1.2rem;
        font-weight: 700;
        font-family: var(--font-heading);
        position: relative; /* For z-index */
    }
    .auth-branding p {
        font-size: 1.2rem; /* Larger paragraph text */
        line-height: 1.6;
        margin-bottom: 2rem;
        position: relative;
    }
    .auth-branding .features { list-style: none; padding: 0; margin-top: 2rem; }
    .auth-branding .features li {
        margin-bottom: 1.2rem; /* More spacing */
        display: flex;
        align-items: center;
        font-size: 1.1rem;
        font-weight: 500;
        position: relative;
    }
    .auth-branding .features svg {
        width: 26px; /* Larger icons */
        height: 26px;
        margin-right: 12px;
        flex-shrink: 0;
        color: #b3e0ff; /* Lighter icon color */
    }
    
    .auth-container {
        padding: 50px; /* More padding */
        width: 55%;
        box-sizing: border-box;
    }
    .auth-container h3 {
        font-size: 2.2rem; /* Larger heading */
        text-align: center;
        margin-bottom: 2rem;
        color: var(--primary-color);
        font-family: var(--font-heading);
        font-weight: 600;
    }
    
    .divider { display: flex; align-items: center; text-align: center; margin: 2rem 0; /* More margin */ color: #888; font-size: 0.95rem; }
    .divider::before, .divider::after { content: ''; flex: 1; border-bottom: 1px solid var(--border-color-light); }
    .divider:not(:empty)::before { margin-right: 1em; }
    .divider:not(:empty)::after { margin-left: 1em; }

    input, textarea {
        width: 100%;
        padding: 15px 18px; /* More padding */
        margin-bottom: 1.2rem; /* More spacing */
        border-radius: 10px; /* More rounded */
        border: 1px solid var(--border-color-light);
        font-size: 1.05rem; /* Slightly larger font */
        box-sizing: border-box;
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus, textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25); /* Focus ring */
    }
    
    .auth-button, .cta-button {
        border: none;
        cursor: pointer;
        font-weight: 600; /* Bolder */
        transition: all 0.3s ease; /* Smooth transition for all properties */
        font-family: var(--font-body);
    }
    .auth-button.primary, .cta-button {
        background-color: var(--primary-color);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
    }
    .auth-button.primary:hover, .cta-button:hover {
        background-color: #0b5ed7;
        transform: translateY(-2px); /* Lift effect */
        box-shadow: 0 8px 15px rgba(0,0,0,0.1); /* Subtle shadow on hover */
    }
    .auth-button.primary:active, .cta-button:active {
        transform: translateY(0); /* Press effect */
        box-shadow: none;
    }
    .cta-button.outline-button { /* New style for secondary buttons */
        background-color: transparent;
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
    }
    .cta-button.outline-button:hover {
        background-color: var(--primary-color);
        color: white;
    }


    .auth-button.google {
        background-color: white;
        color: #333;
        border: 1px solid var(--border-color-light);
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 12px; /* More space */
        padding: 15px 20px;
        border-radius: 10px;
        font-size: 1.05rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .auth-button.google:hover {
        background-color: var(--bg-light);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .auth-button.google:active {
        transform: translateY(0);
        box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    .google-icon { width: 22px; height: 22px; } /* Larger icon */

    .card {
        background-color: var(--card-bg-light);
        border-radius: 12px; /* More rounded */
        padding: 2.5rem; /* More padding */
        margin-bottom: 2.5rem;
        box-shadow: 0 8px 25px rgba(0,0,0,0.08); /* Stronger shadow */
        border: 1px solid var(--border-color-light);
    }
    
    .message {
        text-align: center;
        font-weight: 500;
        padding: 1rem;
        border-radius: 8px; /* More rounded */
        margin-top: 1.5rem;
        visibility: hidden;
        opacity: 0;
        transition: visibility 0s, opacity 0.4s linear; /* Slower transition */
    }
    .message.show { visibility: visible; opacity: 1; }
    .message.success { color: var(--success-color); background-color: rgba(40, 167, 69, 0.12); }
    .message.error { color: var(--error-color); background-color: rgba(220, 53, 69, 0.12); }

    #dark-mode-toggle {
        background: none;
        border: none;
        font-size: 1.7rem; /* Larger toggle */
        cursor: pointer;
        color: var(--text-light); /* Inherit color */
        transition: transform 0.2s ease;
    }
    .dark-mode #dark-mode-toggle { color: var(--text-dark); }
    #dark-mode-toggle:hover { transform: scale(1.1); }

    /* --- Pricing Section --- */
    #pricing-section {
        background-color: var(--bg-light); /* Light mode background */
        padding-top: 6rem;
        padding-bottom: 6rem;
    }
    .dark-mode #pricing-section {
        background-color: var(--bg-dark);
    }
    
    .pricing-toggle {
        display: flex;
        justify-content: center;
        margin-bottom: 3rem;
        background-color: var(--card-bg-light);
        border-radius: 50px;
        padding: 5px;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
        width: fit-content;
        margin: 0 auto 3rem auto;
    }
    .dark-mode .pricing-toggle {
        background-color: #3b4e61;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
    }

    .toggle-button {
        padding: 12px 25px;
        border: none;
        background-color: transparent;
        border-radius: 50px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        color: var(--text-light);
        transition: all 0.3s ease;
        position: relative;
    }
    .dark-mode .toggle-button {
        color: var(--text-dark);
    }

    .toggle-button.active {
        background-color: var(--primary-color);
        color: white;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .toggle-button:hover:not(.active) {
        background-color: var(--border-color-light);
    }
    .dark-mode .toggle-button:hover:not(.active) {
        background-color: var(--border-color-dark);
    }

    .toggle-button .badge {
        position: absolute;
        top: -10px;
        right: -10px;
        background-color: var(--highlight-yellow);
        color: #333;
        font-size: 0.75rem;
        padding: 3px 8px;
        border-radius: 5px;
        font-weight: 700;
        white-space: nowrap;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .pricing-cards-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2.5rem;
        max-width: 1000px;
        margin: 0 auto;
    }

    .pricing-card {
        background-color: var(--card-bg-light);
        border-radius: 12px;
        padding: 2.5rem 2rem;
        box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        border: 1px solid var(--border-color-light);
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
    }
    .pricing-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    }

    .pricing-card.primary-plan {
        border-color: var(--primary-color);
        box-shadow: 0 8px 30px rgba(13, 110, 253, 0.2);
    }
    .dark-mode .pricing-card.primary-plan {
        border-color: var(--primary-color);
        box-shadow: 0 8px 30px rgba(13, 110, 253, 0.4);
    }

    .pricing-card h3 {
        font-family: var(--font-heading);
        font-size: 1.8rem;
        color: var(--primary-color);
        margin-bottom: 0.8rem;
    }
    .pricing-card .price-value {
        font-size: 3.5rem;
        font-weight: 700;
        color: var(--text-light);
        margin-bottom: 0.5rem;
        line-height: 1;
    }
    .dark-mode .pricing-card .price-value { color: var(--text-dark); }

    .pricing-card .currency-symbol,
    .pricing-card .price-period {
        font-size: 1.5rem;
        vertical-align: super;
        font-weight: 500;
        color: var(--secondary-color);
    }
    .pricing-card .price-description {
        font-size: 1rem;
        color: var(--secondary-color);
        min-height: 40px; /* Ensure consistent height */
        margin-bottom: 1.5rem;
    }
    .pricing-card .features-list {
        list-style: none;
        padding: 0;
        margin-bottom: 2rem;
        text-align: left;
        width: 100%;
    }
    .pricing-card .features-list li {
        display: flex;
        align-items: center;
        margin-bottom: 0.8rem;
        font-size: 1.05rem;
        color: var(--text-light);
    }
    .dark-mode .pricing-card .features-list li { color: var(--text-dark); }

    .pricing-card .features-list .check-icon {
        width: 20px;
        height: 20px;
        color: var(--success-color);
        margin-right: 10px;
        flex-shrink: 0;
    }
    .pricing-card .features-list .x-icon {
        width: 20px;
        height: 20px;
        color: var(--error-color);
        margin-right: 10px;
        flex-shrink: 0;
    }
    .pricing-card .features-list .faded-feature {
        color: #a0aebc; /* Slightly faded for less emphasis */
    }
    .dark-mode .pricing-card .features-list .faded-feature {
        color: #6a7a8a;
    }

    .pricing-card .plan-button {
        margin-top: auto; /* Push button to the bottom */
        width: 90%;
        padding: 14px 25px;
    }
    .pricing-card.primary-plan .plan-button {
        background-color: var(--primary-color);
    }

    .recommended-badge {
        position: absolute;
        top: 0;
        right: 0;
        background-color: var(--highlight-yellow);
        color: #333;
        font-size: 0.85rem;
        font-weight: 700;
        padding: 5px 15px;
        border-top-right-radius: 12px;
        border-bottom-left-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }


    /* --- Dashboard Specific Styles --- */
    #dashboard-section {
        padding-top: 2rem;
    }

    .dashboard-header {
        text-align: center;
        margin-bottom: 3rem;
    }
    .dashboard-header h2 {
        font-family: var(--font-heading);
        font-size: 2.5rem;
        color: var(--primary-color);
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr; /* Default to single column */
        gap: 2.5rem;
    }

    /* Adjusting for larger screens */
    @media (min-width: 768px) {
        .dashboard-grid {
            grid-template-columns: 1.5fr 1fr; /* Two columns for tablet/desktop */
            grid-template-areas:
                "invoice-generator profile"
                "upgrade upgrade"; /* Upgrade section spans full width */
        }
        #invoice-generator-card { grid-area: invoice-generator; }
        #profile-card { grid-area: profile; }
        #upgrade-section { grid-area: upgrade; }
    }
    
    @media (min-width: 992px) { /* Even larger screens, three columns */
        .dashboard-grid {
            grid-template-columns: 1.5fr 1fr 1fr; /* Invoice, Profile, Upgrade */
            grid-template-areas:
                "invoice-generator profile upgrade";
        }
    }


    /* Profile Card specific */
    #profile-card p {
        font-size: 1.05rem;
        margin-bottom: 0.8rem;
    }
    #profile-card strong {
        color: var(--primary-color);
    }
    #profile-card .cta-button {
        margin-top: 1.5rem;
    }

    /* Upgrade Section specific */
    #upgrade-section h3 {
        font-family: var(--font-heading);
        font-size: 1.8rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
    }
    #upgrade-section p {
        font-size: 1.1rem;
        color: var(--text-light);
        margin-bottom: 2rem;
    }
    .dark-mode #upgrade-section p { color: var(--text-dark); }

    .upgrade-plans-grid {
        display: flex;
        justify-content: center;
        gap: 2rem;
        flex-wrap: wrap; /* Allow wrapping on smaller screens */
    }

    .upgrade-plan-card {
        flex: 1; /* Allow cards to grow */
        min-width: 280px; /* Minimum width for cards */
        max-width: 350px; /* Max width to prevent too wide cards */
        background-color: var(--bg-light);
        border: 1px solid var(--border-color-light);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .dark-mode .upgrade-plan-card {
        background-color: #3b4e61;
        border-color: var(--border-color-dark);
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .upgrade-plan-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }

    .upgrade-plan-card h4 {
        font-family: var(--font-heading);
        font-size: 1.5rem;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }
    .upgrade-price {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--text-light);
        margin-bottom: 1rem;
    }
    .dark-mode .upgrade-price { color: var(--text-dark); }

    .upgrade-price span {
        font-size: 1.2rem;
        vertical-align: super;
        color: var(--secondary-color);
        font-weight: 500;
    }
    .upgrade-features {
        list-style: none;
        padding: 0;
        margin-bottom: 1.5rem;
        text-align: left;
    }
    .upgrade-features li {
        font-size: 0.95rem;
        margin-bottom: 0.5rem;
        color: var(--text-light);
        display: flex;
        align-items: center;
    }
    .dark-mode .upgrade-features li { color: var(--text-dark); }
    .upgrade-features li svg {
        width: 18px;
        height: 18px;
        margin-right: 8px;
        color: var(--success-color);
        flex-shrink: 0;
    }
    .select-upgrade-plan-btn {
        width: 100%;
        padding: 12px 20px;
    }


    /* --- Responsive Adjustments --- */
    @media (max-width: 992px) { /* Adjust breakpoint for tablets */
        .auth-wrapper { flex-direction: column; max-width: 600px; } /* Stack vertically */
        .auth-branding, .auth-container { width: 100%; padding: 30px; }
        .auth-branding { display: none; } /* Hide branding on smaller screens */
        #auth-section { margin-top: 2rem; } /* Less top margin on mobile */

        #hero-section h1 { font-size: 2.5rem; }
        #hero-section p { font-size: 1.1rem; }
        .hero-buttons .cta-button {
            padding: 15px 25px;
            font-size: 1rem;
            margin: 0.5rem 0.5rem;
        }
        main { margin-top: 6rem; }

        .section-container h2 { font-size: 2.2rem; }
        .section-description { font-size: 1rem; }
        .pricing-cards-container {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        .pricing-card { padding: 2rem 1.5rem; }
        .pricing-card .price-value { font-size: 3rem; }
    }

    @media (max-width: 576px) { /* Mobile specific */
        header { padding: 0.8rem 1rem; }
        .logo-title { font-size: 1.4rem; }
        .auth-container h3 { font-size: 1.8rem; }
        input, textarea, .auth-button, .cta-button { padding: 12px 15px; font-size: 0.95rem; }
        .hero-buttons { flex-direction: column; } /* Stack buttons vertically on very small screens */
        .hero-buttons .cta-button { margin: 0.5rem 0; width: 80%; }

        .section-container { padding: 3rem 1rem; }
        .section-container h2 { font-size: 2rem; }
        .section-description { font-size: 0.9rem; margin-bottom: 2rem; }
        .pricing-toggle { width: 100%; border-radius: 8px; padding: 3px; }
        .toggle-button { padding: 10px 15px; font-size: 0.9rem; }
        .pricing-cards-container { gap: 1.5rem; }
        .pricing-card { padding: 1.5rem 1rem; }
        .pricing-card h3 { font-size: 1.6rem; }
        .pricing-card .price-value { font-size: 2.8rem; }
        .pricing-card .currency-symbol, .pricing-card .price-period { font-size: 1.2rem; }
        .pricing-card .features-list li { font-size: 0.9rem; }

        .dashboard-grid { gap: 1.5rem; }
        #profile-card { padding: 1.5rem; }
        #upgrade-section { padding: 1.5rem; }
        .upgrade-plans-grid { flex-direction: column; align-items: center; }
        .upgrade-plan-card { width: 90%; max-width: 320px; }
    }
</style>
<script>
    // === CONFIGURATION (Your keys are already here from previous steps) ===
    const SUPABASE_URL = 'https://gjpzbbpgqzqbmoomygjy.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqcHpiYnBncXpxYm1vb215Z2p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMDcyMzUsImexpxcCI6MjA2ODY4MzIzNX0.0EbdKvDPrHZiRWWFZkTFgV2O4l6xHc3arz0BwCmjA98';

    // === INITIALIZATION ===
    const { createClient } = supabase;
    const _supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    window.jsPDF = window.jspdf.jsPDF;

    // === DOM ELEMENTS ===
    const authSection = document.getElementById('auth-section');
    const dashboardSection = document.getElementById('dashboard-section');
    const heroSection = document.getElementById('hero-section');
    const pricingSection = document.getElementById('pricing-section'); // New
    const getStartedBtn = document.getElementById('get-started-btn');
    const learnMoreBtn = document.getElementById('learn-more-btn');
    const signOutBtn = document.getElementById('sign-out-btn');
    const googleSignInBtn = document.getElementById('google-signin-btn');
    const signInEmailBtn = document.getElementById('sign-in-email-btn');
    const emailInput = document.getElementById('email-input');
    const authMessage = document.getElementById('auth-message');
    const darkModeToggle = document.getElementById('dark-mode-toggle');

    // Pricing toggle elements
    const monthlyToggle = document.getElementById('monthly-toggle');
    const yearlyToggle = document.getElementById('yearly-toggle');
    const priceMonthlyElements = document.querySelectorAll('.price-monthly');
    const priceYearlyElements = document.querySelectorAll('.price-yearly');
    const pricePeriodElements = document.querySelectorAll('.price-period');

    // Dashboard profile elements
    let profileEmailElement; // Will be assigned after dashboard loads
    let profilePlanElement;
    let profileInvoiceCountElement;
    let manageProfileBtn;

    // Dashboard upgrade elements
    let upgradeSection; // Will be assigned after dashboard loads
    let selectUpgradePlanButtons;
    let upgradeMessage;


    // === AUTHENTICATION ===
    const handleGoogleSignIn = async () => {
        const { error } = await _supabase.auth.signInWithOAuth({ provider: 'google' });
        if (error) displayMessage(authMessage, `Error: ${error.message}`, 'error');
    };

    const handleEmailSignIn = async () => {
        const email = emailInput.value;
        if (!email) return displayMessage(authMessage, 'Please enter your email.', 'error');
        signInEmailBtn.disabled = true;
        signInEmailBtn.innerText = "Sending...";
        const { error } = await _supabase.auth.signInWithOtp({ email });
        if (error) {
            displayMessage(authMessage, `Error: ${error.message}`, 'error');
        } else {
            displayMessage(authMessage, 'Check your email for the magic sign-in link!', 'success');
        }
        signInEmailBtn.disabled = false;
        signInEmailBtn.innerText = "Continue with Email";
    };

    const handleSignOut = async () => {
        await _supabase.auth.signOut();
        window.location.reload();
    };

    // === UI MANAGEMENT ===
    const setupUI = (user) => {
        if (user) {
            heroSection.style.display = 'none';
            pricingSection.style.display = 'none'; // Hide pricing when logged in
            authSection.style.display = 'none';

            // Dynamically load dashboard content if not already loaded
            if(!document.getElementById('profile-card')) {
                dashboardSection.innerHTML = `
                    <div class="dashboard-header">
                        <h2 id="welcome-message">Welcome, ${user.email.split('@')[0]}</h2>
                    </div>
                    <div class="dashboard-grid">
                        <div class="card" id="profile-card">
                            <h3>Your Profile</h3>
                            <p><strong>Email:</strong> <span id="profile-email"></span></p>
                            <p><strong>Current Plan:</strong> <span id="profile-plan"></span></p>
                            <p><strong>Invoices This Month:</strong> <span id="profile-invoice-count"></span></p>
                            <button id="manage-profile-btn" class="cta-button outline-button" style="width: auto;">Manage Account</button>
                        </div>

                        <div class="card" id="invoice-generator-card">
                            <h3>Create New Invoice</h3>
                            <form id="invoice-form">
                                <input type="text" id="client-name" name="client_name" placeholder="Client Name" required>
                                <input type="email" id="client-email" name="client_email" placeholder="Client Email" required>
                                <textarea id="item-description" name="item_description" placeholder="Item Description (e.g., Web Design Services)" required></textarea>
                                <div class="form-row" style="display: flex; gap: 1rem;">
                                    <input type="number" id="quantity" name="quantity" placeholder="Quantity" required min="1">
                                    <input type="number" id="unit-price" name="unit_price" placeholder="Unit Price" required min="0" step="0.01">
                                </div>
                                <div class="form-row" style="display: flex; gap: 1rem;">
                                    <input type="text" id="currency" name="currency" value="USD">
                                    <input type="number" id="tax-rate" name="tax_rate" placeholder="Tax Rate (%)" min="0">
                                </div>
                                <label for="due-date">Due Date:</label>
                                <input type="date" id="due-date" name="due_date" required>
                                <button type="submit" id="generate-invoice-btn" class="cta-button">Generate & Download PDF</button>
                            </form>
                            <p id="invoice-message" class="message"></p>
                        </div>

                        <div class="card" id="upgrade-section">
                            <h3>Upgrade Your Plan</h3>
                            <p>Unlock more features and higher invoice limits!</p>
                            <div class="upgrade-plans-grid">
                                <div class="upgrade-plan-card">
                                    <h4>Pro Plan</h4>
                                    <p class="upgrade-price">$<span class="upgrade-monthly-pro">9</span>/month</p>
                                    <ul class="upgrade-features">
                                        <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Up to 50 invoices/month</li>
                                        <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Advanced PDF customization</li>
                                        <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> AI Suggestions</li>
                                    </ul>
                                    <button class="cta-button select-upgrade-plan-btn" data-plan="pro" data-price-monthly="9" data-price-yearly="72">Upgrade to Pro</button>
                                </div>
                                <div class="upgrade-plan-card">
                                    <h4>Advanced Plan</h4>
                                    <p class="upgrade-price">$<span class="upgrade-monthly-advanced">19</span>/month</p>
                                    <ul class="upgrade-features">
                                        <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Unlimited Invoices</li>
                                        <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Custom Branding</li>
                                        <li><svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Priority Support</li>
                                    </ul>
                                    <button class="cta-button select-upgrade-plan-btn" data-plan="advanced" data-price-monthly="19" data-price-yearly="180">Upgrade to Advanced</button>
                                </div>
                            </div>
                            <p id="upgrade-message" class="message"></p>
                        </div>
                    </div>
                `;
            }
            dashboardSection.style.display = 'block';
            signOutBtn.style.display = 'block';

            // Assign elements now that dashboard HTML is loaded
            profileEmailElement = document.getElementById('profile-email');
            profilePlanElement = document.getElementById('profile-plan');
            profileInvoiceCountElement = document.getElementById('profile-invoice-count');
            manageProfileBtn = document.getElementById('manage-profile-btn');
            upgradeSection = document.getElementById('upgrade-section');
            selectUpgradePlanButtons = document.querySelectorAll('.select-upgrade-plan-btn');
            upgradeMessage = document.getElementById('upgrade-message');


            fetchAndDisplayUserData(user.id);
            // Re-bind events for dynamically added elements
            document.getElementById('invoice-form').addEventListener('submit', handleInvoiceGeneration);
            
            // Event listener for the "Manage Account" button
            if (manageProfileBtn) {
                manageProfileBtn.addEventListener('click', () => {
                    alert('Manage Account functionality coming soon! (This would lead to a dedicated profile settings page)');
                });
            }

            // Event listeners for upgrade buttons
            selectUpgradePlanButtons.forEach(button => {
                button.addEventListener('click', handleUpgradePlan);
            });

        } else {
            heroSection.style.display = 'flex';
            pricingSection.style.display = 'block'; // Show pricing when logged out
            authSection.style.display = 'flex';
            dashboardSection.style.display = 'none';
            signOutBtn.style.display = 'none';
        }
    };
    
    const displayMessage = (element, text, type) => {
        element.textContent = text;
        element.className = `message ${type} show`;
        setTimeout(() => {
             element.classList.remove('show');
        }, 5000);
    };

    const toggleDarkMode = () => {
        document.body.classList.toggle('dark-mode');
        const isDarkMode = document.body.classList.contains('dark-mode');
        document.body.classList.toggle('light-mode', !isDarkMode);
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
    };
    

    // === NEW PRICING TOGGLE LOGIC ===
    const updatePricingDisplay = (isMonthly) => {
        priceMonthlyElements.forEach(el => el.style.display = isMonthly ? 'inline' : 'none');
        priceYearlyElements.forEach(el => el.style.display = isMonthly ? 'none' : 'inline');
        pricePeriodElements.forEach(el => el.textContent = isMonthly ? '/month' : '/year');

        if (isMonthly) {
            monthlyToggle.classList.add('active');
            yearlyToggle.classList.remove('active');
        } else {
            monthlyToggle.classList.remove('active');
            yearlyToggle.classList.add('active');
        }
    };


    // === DATA & BUSINESS LOGIC (Modified) ===
    async function fetchAndDisplayUserData(userId) {
        try {
            const { data: userProfile, error: profileError } = await _supabase
                .from('user_profiles')
                .select('*')
                .eq('id', userId)
                .single();

            if (profileError && profileError.message !== 'No rows found') {
                console.error('Error fetching user profile:', profileError);
                displayMessage(document.getElementById('invoice-message'), `Error loading plan: ${profileError.message}`, 'error');
                return;
            }

            // Ensure profile exists or create a default one
            let currentPlan = userProfile ? userProfile.plan : 'Free';
            if (!userProfile) {
                const { data: newProfile, error: insertError } = await _supabase
                    .from('user_profiles')
                    .insert([{ id: userId, plan: 'Free', subscribed_at: new Date().toISOString(), subscription_status: 'active' }]);
                if (insertError) {
                    console.error('Error creating new user profile:', insertError);
                    displayMessage(document.getElementById('invoice-message'), `Error setting up profile: ${insertError.message}`, 'error');
                    return;
                }
                currentPlan = 'Free';
            }


            const { data: invoices, error: invoicesError } = await _supabase
                .from('invoices')
                .select('*')
                .eq('user_id', userId)
                .gte('created_at', new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString());

            if (invoicesError) {
                console.error('Error fetching invoices:', invoicesError);
                displayMessage(document.getElementById('invoice-message'), `Error loading invoices: ${invoicesError.message}`, 'error');
                return;
            }

            // Update Profile Card
            if (profileEmailElement) profileEmailElement.textContent = _supabase.auth.user()?.email || 'N/A';
            if (profilePlanElement) profilePlanElement.textContent = currentPlan;
            
            const invoiceCount = invoices ? invoices.length : 0;
            let invoiceLimit = 0;
            switch (currentPlan) {
                case 'Free':
                    invoiceLimit = 5;
                    break;
                case 'Pro':
                    invoiceLimit = 50;
                    break;
                case 'Advanced':
                    invoiceLimit = 'Unlimited';
                    break;
                default:
                    invoiceLimit = 5; // Default for unknown plans
            }
            if (profileInvoiceCountElement) profileInvoiceCountElement.textContent = `${invoiceCount}/${invoiceLimit === 'Unlimited' ? 'Unlimited' : invoiceLimit}`;

            // Update welcome message
            const welcomeMessageElement = document.getElementById('welcome-message');
            if (welcomeMessageElement) {
                const userEmail = _supabase.auth.user()?.email;
                if (userEmail) {
                    welcomeMessageElement.textContent = `Welcome, ${userEmail.split('@')[0]}!`;
                }
            }

            // Show/Hide Upgrade Section based on current plan
            if (upgradeSection) {
                if (currentPlan === 'Advanced') {
                    upgradeSection.style.display = 'none';
                } else {
                    upgradeSection.style.display = 'block';
                    // Disable buttons for current plan or lower plans
                    selectUpgradePlanButtons.forEach(button => {
                        const plan = button.dataset.plan;
                        if (plan === 'pro' && currentPlan === 'Pro') {
                            button.disabled = true;
                            button.textContent = 'Current Plan';
                        } else if (plan === 'advanced' && currentPlan === 'Advanced') {
                             button.disabled = true;
                            button.textContent = 'Current Plan';
                        } else if (plan === 'advanced' && currentPlan === 'Pro') {
                             button.disabled = false;
                            button.textContent = 'Upgrade to Advanced';
                        } else {
                            button.disabled = false;
                            button.textContent = `Upgrade to ${plan.charAt(0).toUpperCase() + plan.slice(1)}`;
                        }
                    });
                }
            }

            // Disable invoice generation if limit reached for free/pro plans
            const generateInvoiceBtn = document.getElementById('generate-invoice-btn');
            if (currentPlan === 'Free' && invoiceCount >= invoiceLimit) {
                generateInvoiceBtn.disabled = true;
                generateInvoiceBtn.textContent = 'Upgrade to generate more invoices';
                displayMessage(document.getElementById('invoice-message'), 'You have reached your invoice limit for the Free plan. Please upgrade.', 'error');
            } else if (currentPlan === 'Pro' && invoiceCount >= invoiceLimit) {
                generateInvoiceBtn.disabled = true;
                generateInvoiceBtn.textContent = 'Upgrade to generate more invoices';
                displayMessage(document.getElementById('invoice-message'), 'You have reached your invoice limit for the Pro plan. Please upgrade to Advanced.', 'error');
            }
            else {
                generateInvoiceBtn.disabled = false;
                generateInvoiceBtn.textContent = 'Generate & Download PDF';
            }

        } catch (error) {
            console.error('Unexpected error in fetchAndDisplayUserData:', error);
            displayMessage(document.getElementById('invoice-message'), `An unexpected error occurred: ${error.message}`, 'error');
        }
    }


    async function handleInvoiceGeneration(e) {
        e.preventDefault();
        const invoiceMessage = document.getElementById('invoice-message');
        invoiceMessage.classList.remove('show', 'success', 'error');

        const user = _supabase.auth.user();
        if (!user) {
            displayMessage(invoiceMessage, 'You must be logged in to generate invoices.', 'error');
            return;
        }

        const clientName = document.getElementById('client-name').value;
        const clientEmail = document.getElementById('client-email').value;
        const itemDescription = document.getElementById('item-description').value;
        const quantity = parseFloat(document.getElementById('quantity').value);
        const unitPrice = parseFloat(document.getElementById('unit-price').value);
        const currency = document.getElementById('currency').value;
        const taxRate = parseFloat(document.getElementById('tax-rate').value || 0);
        const dueDate = document.getElementById('due-date').value;

        if (!clientName || !clientEmail || !itemDescription || isNaN(quantity) || isNaN(unitPrice) || !dueDate) {
            displayMessage(invoiceMessage, 'Please fill in all required fields.', 'error');
            return;
        }

        const subtotal = quantity * unitPrice;
        const taxAmount = subtotal * (taxRate / 100);
        const total = subtotal + taxAmount;

        const invoiceData = {
            user_id: user.id,
            client_name: clientName,
            client_email: clientEmail,
            item_description: itemDescription,
            quantity: quantity,
            unit_price: unitPrice,
            subtotal: subtotal,
            tax_rate: taxRate,
            tax_amount: taxAmount,
            total: total,
            currency: currency,
            due_date: dueDate,
            invoice_number: `INV-${Date.now()}` // Simple unique invoice number
        };

        try {
            const { data, error } = await _supabase
                .from('invoices')
                .insert([invoiceData]);

            if (error) {
                throw error;
            }

            displayMessage(invoiceMessage, 'Invoice generated and saved successfully!', 'success');
            generatePDF(invoiceData, total); // Generate PDF even if it's saved

            // Refresh user data to update invoice count and potential plan limits
            await fetchAndDisplayUserData(user.id);

            // Optionally clear the form
            document.getElementById('invoice-form').reset();

        } catch (error) {
            displayMessage(invoiceMessage, `Error generating invoice: ${error.message}`, 'error');
            console.error('Invoice generation error:', error);
        }
    }

    function generatePDF(data, total) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.setFontSize(28);
        doc.setTextColor("#0d6efd"); // Primary blue color
        doc.text("INVOICE", 105, 30, null, null, "center");

        doc.setFontSize(10);
        doc.setTextColor("#6c757d"); // Secondary gray
        doc.text(`Invoice Number: ${data.invoice_number}`, 105, 40, null, null, "center");
        doc.text(`Date: ${new Date().toLocaleDateString()}`, 105, 45, null, null, "center");
        doc.text(`Due Date: ${new Date(data.due_date).toLocaleDateString()}`, 105, 50, null, null, "center");

        // From Section (Your Company)
        doc.setFontSize(12);
        doc.setTextColor("#212529"); // Dark text for light mode
        doc.text("From:", 20, 70);
        doc.setFontSize(10);
        doc.text("Global Invoice AI", 20, 77);
        doc.text("123 AI Street, Tech City", 20, 82);
        doc.text("invoice@globalai.com", 20, 87);

        // To Section (Client)
        doc.setFontSize(12);
        doc.text("To:", 110, 70);
        doc.setFontSize(10);
        doc.text(data.client_name, 110, 77);
        doc.text(data.client_email, 110, 82);

        // Items Table Header
        doc.setFillColor("#0d6efd");
        doc.rect(20, 100, 170, 10, "F"); // Background for header
        doc.setFontSize(10);
        doc.setTextColor(255, 255, 255); // White text
        doc.text("Description", 25, 106);
        doc.text("Qty", 100, 106);
        doc.text("Unit Price", 125, 106);
        doc.text("Subtotal", 160, 106);

        // Item Row
        doc.setTextColor("#212529"); // Black text for items
        doc.setFontSize(10);
        let yPos = 115;
        doc.text(data.item_description, 25, yPos);
        doc.text(data.quantity.toString(), 100, yPos);
        doc.text(`${data.currency} ${data.unit_price.toFixed(2)}`, 125, yPos);
        doc.text(`${data.currency} ${data.subtotal.toFixed(2)}`, 160, yPos);

        yPos += 15; // Space for next line if needed

        // Totals
        doc.setFontSize(10);
        doc.setTextColor("#212529");
        doc.text(`Subtotal: ${data.currency} ${data.subtotal.toFixed(2)}`, 160, yPos);
        yPos += 7;
        doc.text(`Tax (${data.tax_rate}%): ${data.currency} ${data.tax_amount.toFixed(2)}`, 160, yPos);
        yPos += 7;
        doc.setFontSize(12);
        doc.setTextColor("#0d6efd"); // Primary color for total
        doc.text(`TOTAL: ${data.currency} ${total.toFixed(2)}`, 160, yPos);

        doc.save(`Invoice_${data.invoice_number}.pdf`);
    }

    // === NEW PAYMENT INTEGRATION (Placeholder) ===
    async function handleUpgradePlan(event) {
        const user = _supabase.auth.user();
        if (!user) {
            displayMessage(upgradeMessage, 'Please sign in to upgrade your plan.', 'error');
            return;
        }

        const selectedPlan = event.target.dataset.plan;
        const priceMonthly = event.target.dataset.priceMonthly;
        const priceYearly = event.target.dataset.priceYearly;

        const isYearly = yearlyToggle.classList.contains('active');
        const price = isYearly ? priceYearly : priceMonthly;
        const interval = isYearly ? 'yearly' : 'monthly';

        displayMessage(upgradeMessage, `Initiating payment for ${selectedPlan.toUpperCase()} Plan (${interval}, $${price})...`, 'success');
        
        // --- THIS IS WHERE YOU INTEGRATE WITH A PAYMENT GATEWAY ---
        // 1. Create a Checkout Session (Server-Side)
        //    You would send `selectedPlan`, `price`, `interval`, and `user.id` to your backend.
        //    Your backend (e.g., a simple Node.js server, a Cloud Function) would
        //    interact with Stripe, Razorpay, or PayPal to create a checkout session.
        //    It would return a `session_id` or `checkout_url`.

        // Example for Stripe Checkout (Conceptual)
        /*
        try {
            const response = await fetch('/api/create-checkout-session', { // Your backend endpoint
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    plan: selectedPlan,
                    price: price,
                    interval: interval,
                    userId: user.id
                })
            });
            const { sessionId } = await response.json();

            // 2. Redirect User to Payment Gateway
            const stripe = Stripe('YOUR_STRIPE_PUBLIC_KEY'); // Replace with your actual public key
            stripe.redirectToCheckout({ sessionId: sessionId });

        } catch (error) {
            console.error('Payment initiation failed:', error);
            displayMessage(upgradeMessage, `Payment failed: ${error.message}`, 'error');
        }
        */

        // For now, let's simulate success and update the plan in Supabase directly
        // In a real app, this update would happen ONLY AFTER successful payment confirmation
        // from your payment gateway's webhook or success callback.

        try {
            const { data, error } = await _supabase
                .from('user_profiles')
                .update({ plan: selectedPlan, subscribed_at: new Date().toISOString(), subscription_status: 'active' })
                .eq('id', user.id);

            if (error) throw error;

            displayMessage(upgradeMessage, `Successfully upgraded to ${selectedPlan.toUpperCase()} Plan!`, 'success');
            await fetchAndDisplayUserData(user.id); // Refresh dashboard with new plan
            
            // For a real app, after successful payment, you'd direct the user back to the dashboard.
            // You might have a dedicated success page on your backend that then redirects back here.

        } catch (error) {
            displayMessage(upgradeMessage, `Error updating plan in DB (simulated): ${error.message}`, 'error');
            console.error('Simulated plan update failed:', error);
        }
    }


    // === EVENT LISTENERS & INITIAL LOAD ===
    document.addEventListener('DOMContentLoaded', () => {
        googleSignInBtn.addEventListener('click', handleGoogleSignIn);
        signInEmailBtn.addEventListener('click', handleEmailSignIn);
        signOutBtn.addEventListener('click', handleSignOut);
        darkModeToggle.addEventListener('click', toggleDarkMode);

        // New event listeners for Hero section buttons
        getStartedBtn.addEventListener('click', () => {
            authSection.scrollIntoView({ behavior: 'smooth' });
        });
        learnMoreBtn.addEventListener('click', () => {
            pricingSection.scrollIntoView({ behavior: 'smooth' }); // Scroll to pricing
        });

        // Pricing toggle listeners
        monthlyToggle.addEventListener('click', () => updatePricingDisplay(true));
        yearlyToggle.addEventListener('click', () => updatePricingDisplay(false));
        updatePricingDisplay(true); // Default to monthly on load

        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            document.body.classList.remove('light-mode');
        }

        _supabase.auth.onAuthStateChange((_event, session) => {
            setupUI(session ? session.user : null);
        });
    });
</script>

      

